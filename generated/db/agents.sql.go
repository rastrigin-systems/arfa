// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.30.0
// source: agents.sql

package db

import (
	"context"
	"encoding/json"

	"github.com/google/uuid"
	"github.com/jackc/pgx/v5/pgtype"
)

const CheckEmployeeAgentExists = `-- name: CheckEmployeeAgentExists :one
SELECT EXISTS(
    SELECT 1 FROM employee_agent_configs
    WHERE employee_id = $1
      AND agent_id = $2
) AS exists
`

type CheckEmployeeAgentExistsParams struct {
	EmployeeID uuid.UUID `json:"employee_id"`
	AgentID    uuid.UUID `json:"agent_id"`
}

// Check if employee already has this agent assigned
func (q *Queries) CheckEmployeeAgentExists(ctx context.Context, arg CheckEmployeeAgentExistsParams) (bool, error) {
	row := q.db.QueryRow(ctx, CheckEmployeeAgentExists, arg.EmployeeID, arg.AgentID)
	var exists bool
	err := row.Scan(&exists)
	return exists, err
}

const CheckOrgAgentConfigExists = `-- name: CheckOrgAgentConfigExists :one
SELECT EXISTS(
    SELECT 1 FROM org_agent_configs
    WHERE org_id = $1 AND agent_id = $2
) AS exists
`

type CheckOrgAgentConfigExistsParams struct {
	OrgID   uuid.UUID `json:"org_id"`
	AgentID uuid.UUID `json:"agent_id"`
}

// Check if org already has this agent configured
func (q *Queries) CheckOrgAgentConfigExists(ctx context.Context, arg CheckOrgAgentConfigExistsParams) (bool, error) {
	row := q.db.QueryRow(ctx, CheckOrgAgentConfigExists, arg.OrgID, arg.AgentID)
	var exists bool
	err := row.Scan(&exists)
	return exists, err
}

const CheckTeamAgentConfigExists = `-- name: CheckTeamAgentConfigExists :one
SELECT EXISTS(
    SELECT 1 FROM team_agent_configs
    WHERE team_id = $1
      AND agent_id = $2
) AS exists
`

type CheckTeamAgentConfigExistsParams struct {
	TeamID  uuid.UUID `json:"team_id"`
	AgentID uuid.UUID `json:"agent_id"`
}

// Check if team already has this agent configured
func (q *Queries) CheckTeamAgentConfigExists(ctx context.Context, arg CheckTeamAgentConfigExistsParams) (bool, error) {
	row := q.db.QueryRow(ctx, CheckTeamAgentConfigExists, arg.TeamID, arg.AgentID)
	var exists bool
	err := row.Scan(&exists)
	return exists, err
}

const CountEmployeeAgentConfigs = `-- name: CountEmployeeAgentConfigs :one
SELECT COUNT(*)
FROM employee_agent_configs
WHERE employee_id = $1
`

// Count total agent configs for an employee
func (q *Queries) CountEmployeeAgentConfigs(ctx context.Context, employeeID uuid.UUID) (int64, error) {
	row := q.db.QueryRow(ctx, CountEmployeeAgentConfigs, employeeID)
	var count int64
	err := row.Scan(&count)
	return count, err
}

const CountTeamAgentConfigs = `-- name: CountTeamAgentConfigs :one
SELECT COUNT(*) as count
FROM team_agent_configs
WHERE team_id = $1
`

// Count agent configurations for a specific team
func (q *Queries) CountTeamAgentConfigs(ctx context.Context, teamID uuid.UUID) (int64, error) {
	row := q.db.QueryRow(ctx, CountTeamAgentConfigs, teamID)
	var count int64
	err := row.Scan(&count)
	return count, err
}

const CreateAgent = `-- name: CreateAgent :one
INSERT INTO agents (
    name,
    type,
    description,
    provider,
    default_config,
    capabilities,
    llm_provider,
    llm_model,
    is_public
) VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9)
RETURNING id, name, type, description, provider, default_config, capabilities, llm_provider, llm_model, is_public, created_at, updated_at
`

type CreateAgentParams struct {
	Name          string          `json:"name"`
	Type          string          `json:"type"`
	Description   string          `json:"description"`
	Provider      string          `json:"provider"`
	DefaultConfig json.RawMessage `json:"default_config"`
	Capabilities  json.RawMessage `json:"capabilities"`
	LlmProvider   string          `json:"llm_provider"`
	LlmModel      string          `json:"llm_model"`
	IsPublic      bool            `json:"is_public"`
}

// Create a new agent (for testing/admin)
func (q *Queries) CreateAgent(ctx context.Context, arg CreateAgentParams) (Agent, error) {
	row := q.db.QueryRow(ctx, CreateAgent,
		arg.Name,
		arg.Type,
		arg.Description,
		arg.Provider,
		arg.DefaultConfig,
		arg.Capabilities,
		arg.LlmProvider,
		arg.LlmModel,
		arg.IsPublic,
	)
	var i Agent
	err := row.Scan(
		&i.ID,
		&i.Name,
		&i.Type,
		&i.Description,
		&i.Provider,
		&i.DefaultConfig,
		&i.Capabilities,
		&i.LlmProvider,
		&i.LlmModel,
		&i.IsPublic,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}

const CreateEmployeeAgentConfig = `-- name: CreateEmployeeAgentConfig :one
INSERT INTO employee_agent_configs (
    employee_id,
    agent_id,
    config_override,
    is_enabled
) VALUES ($1, $2, $3, $4)
RETURNING id, employee_id, agent_id, config_override, is_enabled, sync_token, last_synced_at, created_at, updated_at
`

type CreateEmployeeAgentConfigParams struct {
	EmployeeID     uuid.UUID       `json:"employee_id"`
	AgentID        uuid.UUID       `json:"agent_id"`
	ConfigOverride json.RawMessage `json:"config_override"`
	IsEnabled      bool            `json:"is_enabled"`
}

type CreateEmployeeAgentConfigRow struct {
	ID             uuid.UUID        `json:"id"`
	EmployeeID     uuid.UUID        `json:"employee_id"`
	AgentID        uuid.UUID        `json:"agent_id"`
	ConfigOverride json.RawMessage  `json:"config_override"`
	IsEnabled      bool             `json:"is_enabled"`
	SyncToken      *string          `json:"sync_token"`
	LastSyncedAt   pgtype.Timestamp `json:"last_synced_at"`
	CreatedAt      pgtype.Timestamp `json:"created_at"`
	UpdatedAt      pgtype.Timestamp `json:"updated_at"`
}

// Create a new agent configuration for an employee
func (q *Queries) CreateEmployeeAgentConfig(ctx context.Context, arg CreateEmployeeAgentConfigParams) (CreateEmployeeAgentConfigRow, error) {
	row := q.db.QueryRow(ctx, CreateEmployeeAgentConfig,
		arg.EmployeeID,
		arg.AgentID,
		arg.ConfigOverride,
		arg.IsEnabled,
	)
	var i CreateEmployeeAgentConfigRow
	err := row.Scan(
		&i.ID,
		&i.EmployeeID,
		&i.AgentID,
		&i.ConfigOverride,
		&i.IsEnabled,
		&i.SyncToken,
		&i.LastSyncedAt,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}

const CreateOrgAgentConfig = `-- name: CreateOrgAgentConfig :one
INSERT INTO org_agent_configs (
    org_id,
    agent_id,
    config,
    is_enabled
) VALUES ($1, $2, $3, $4)
RETURNING id, org_id, agent_id, config, is_enabled, created_at, updated_at
`

type CreateOrgAgentConfigParams struct {
	OrgID     uuid.UUID       `json:"org_id"`
	AgentID   uuid.UUID       `json:"agent_id"`
	Config    json.RawMessage `json:"config"`
	IsEnabled bool            `json:"is_enabled"`
}

// Create org-level agent config
func (q *Queries) CreateOrgAgentConfig(ctx context.Context, arg CreateOrgAgentConfigParams) (OrgAgentConfig, error) {
	row := q.db.QueryRow(ctx, CreateOrgAgentConfig,
		arg.OrgID,
		arg.AgentID,
		arg.Config,
		arg.IsEnabled,
	)
	var i OrgAgentConfig
	err := row.Scan(
		&i.ID,
		&i.OrgID,
		&i.AgentID,
		&i.Config,
		&i.IsEnabled,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}

const CreateTeamAgentConfig = `-- name: CreateTeamAgentConfig :one
INSERT INTO team_agent_configs (
    team_id,
    agent_id,
    config_override,
    is_enabled
) VALUES ($1, $2, $3, $4)
RETURNING id, team_id, agent_id, config_override, is_enabled, created_at, updated_at
`

type CreateTeamAgentConfigParams struct {
	TeamID         uuid.UUID       `json:"team_id"`
	AgentID        uuid.UUID       `json:"agent_id"`
	ConfigOverride json.RawMessage `json:"config_override"`
	IsEnabled      bool            `json:"is_enabled"`
}

// Create a new team-level agent configuration override
func (q *Queries) CreateTeamAgentConfig(ctx context.Context, arg CreateTeamAgentConfigParams) (TeamAgentConfig, error) {
	row := q.db.QueryRow(ctx, CreateTeamAgentConfig,
		arg.TeamID,
		arg.AgentID,
		arg.ConfigOverride,
		arg.IsEnabled,
	)
	var i TeamAgentConfig
	err := row.Scan(
		&i.ID,
		&i.TeamID,
		&i.AgentID,
		&i.ConfigOverride,
		&i.IsEnabled,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}

const DeleteEmployeeAgentConfig = `-- name: DeleteEmployeeAgentConfig :exec
DELETE FROM employee_agent_configs
WHERE id = $1
`

// Delete an agent configuration (hard delete)
func (q *Queries) DeleteEmployeeAgentConfig(ctx context.Context, id uuid.UUID) error {
	_, err := q.db.Exec(ctx, DeleteEmployeeAgentConfig, id)
	return err
}

const DeleteOrgAgentConfig = `-- name: DeleteOrgAgentConfig :exec
DELETE FROM org_agent_configs
WHERE id = $1
`

// Delete org-level agent config
func (q *Queries) DeleteOrgAgentConfig(ctx context.Context, id uuid.UUID) error {
	_, err := q.db.Exec(ctx, DeleteOrgAgentConfig, id)
	return err
}

const DeleteTeamAgentConfig = `-- name: DeleteTeamAgentConfig :exec
DELETE FROM team_agent_configs
WHERE id = $1
`

// Delete a team agent configuration (hard delete)
func (q *Queries) DeleteTeamAgentConfig(ctx context.Context, id uuid.UUID) error {
	_, err := q.db.Exec(ctx, DeleteTeamAgentConfig, id)
	return err
}

const GetAgentByID = `-- name: GetAgentByID :one
SELECT
    id,
    name,
    type,
    description,
    provider,
    default_config,
    capabilities,
    llm_provider,
    llm_model,
    is_public,
    created_at,
    updated_at
FROM agents
WHERE id = $1
`

// Get a specific agent by ID
func (q *Queries) GetAgentByID(ctx context.Context, id uuid.UUID) (Agent, error) {
	row := q.db.QueryRow(ctx, GetAgentByID, id)
	var i Agent
	err := row.Scan(
		&i.ID,
		&i.Name,
		&i.Type,
		&i.Description,
		&i.Provider,
		&i.DefaultConfig,
		&i.Capabilities,
		&i.LlmProvider,
		&i.LlmModel,
		&i.IsPublic,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}

const GetAgentByName = `-- name: GetAgentByName :one
SELECT
    id,
    name,
    type,
    description,
    provider,
    default_config,
    capabilities,
    llm_provider,
    llm_model,
    is_public,
    created_at,
    updated_at
FROM agents
WHERE name = $1
`

// Get a specific agent by name
func (q *Queries) GetAgentByName(ctx context.Context, name string) (Agent, error) {
	row := q.db.QueryRow(ctx, GetAgentByName, name)
	var i Agent
	err := row.Scan(
		&i.ID,
		&i.Name,
		&i.Type,
		&i.Description,
		&i.Provider,
		&i.DefaultConfig,
		&i.Capabilities,
		&i.LlmProvider,
		&i.LlmModel,
		&i.IsPublic,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}

const GetEmployeeAgentConfig = `-- name: GetEmployeeAgentConfig :one
SELECT
    eac.id,
    eac.employee_id,
    eac.agent_id,
    eac.config_override,
    eac.is_enabled,
    eac.sync_token,
    eac.last_synced_at,
    eac.created_at,
    eac.updated_at,
    a.name as agent_name,
    a.type as agent_type,
    a.provider as agent_provider
FROM employee_agent_configs eac
JOIN agents a ON eac.agent_id = a.id
WHERE eac.id = $1
`

type GetEmployeeAgentConfigRow struct {
	ID             uuid.UUID        `json:"id"`
	EmployeeID     uuid.UUID        `json:"employee_id"`
	AgentID        uuid.UUID        `json:"agent_id"`
	ConfigOverride json.RawMessage  `json:"config_override"`
	IsEnabled      bool             `json:"is_enabled"`
	SyncToken      *string          `json:"sync_token"`
	LastSyncedAt   pgtype.Timestamp `json:"last_synced_at"`
	CreatedAt      pgtype.Timestamp `json:"created_at"`
	UpdatedAt      pgtype.Timestamp `json:"updated_at"`
	AgentName      string           `json:"agent_name"`
	AgentType      string           `json:"agent_type"`
	AgentProvider  string           `json:"agent_provider"`
}

// Get a specific agent configuration by ID
func (q *Queries) GetEmployeeAgentConfig(ctx context.Context, id uuid.UUID) (GetEmployeeAgentConfigRow, error) {
	row := q.db.QueryRow(ctx, GetEmployeeAgentConfig, id)
	var i GetEmployeeAgentConfigRow
	err := row.Scan(
		&i.ID,
		&i.EmployeeID,
		&i.AgentID,
		&i.ConfigOverride,
		&i.IsEnabled,
		&i.SyncToken,
		&i.LastSyncedAt,
		&i.CreatedAt,
		&i.UpdatedAt,
		&i.AgentName,
		&i.AgentType,
		&i.AgentProvider,
	)
	return i, err
}

const GetEmployeeAgentConfigByAgent = `-- name: GetEmployeeAgentConfigByAgent :one
SELECT
    id,
    employee_id,
    agent_id,
    config_override,
    is_enabled,
    sync_token,
    last_synced_at,
    created_at,
    updated_at
FROM employee_agent_configs
WHERE employee_id = $1 AND agent_id = $2
`

type GetEmployeeAgentConfigByAgentParams struct {
	EmployeeID uuid.UUID `json:"employee_id"`
	AgentID    uuid.UUID `json:"agent_id"`
}

type GetEmployeeAgentConfigByAgentRow struct {
	ID             uuid.UUID        `json:"id"`
	EmployeeID     uuid.UUID        `json:"employee_id"`
	AgentID        uuid.UUID        `json:"agent_id"`
	ConfigOverride json.RawMessage  `json:"config_override"`
	IsEnabled      bool             `json:"is_enabled"`
	SyncToken      *string          `json:"sync_token"`
	LastSyncedAt   pgtype.Timestamp `json:"last_synced_at"`
	CreatedAt      pgtype.Timestamp `json:"created_at"`
	UpdatedAt      pgtype.Timestamp `json:"updated_at"`
}

// Get employee-level config for a specific agent
func (q *Queries) GetEmployeeAgentConfigByAgent(ctx context.Context, arg GetEmployeeAgentConfigByAgentParams) (GetEmployeeAgentConfigByAgentRow, error) {
	row := q.db.QueryRow(ctx, GetEmployeeAgentConfigByAgent, arg.EmployeeID, arg.AgentID)
	var i GetEmployeeAgentConfigByAgentRow
	err := row.Scan(
		&i.ID,
		&i.EmployeeID,
		&i.AgentID,
		&i.ConfigOverride,
		&i.IsEnabled,
		&i.SyncToken,
		&i.LastSyncedAt,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}

const GetOrgAgentConfig = `-- name: GetOrgAgentConfig :one

SELECT
    id,
    org_id,
    agent_id,
    config,
    is_enabled,
    created_at,
    updated_at
FROM org_agent_configs
WHERE org_id = $1 AND agent_id = $2
`

type GetOrgAgentConfigParams struct {
	OrgID   uuid.UUID `json:"org_id"`
	AgentID uuid.UUID `json:"agent_id"`
}

// Hierarchical Config Resolution Queries
// These queries fetch configs at different levels for merging
// Get org-level config for an agent
func (q *Queries) GetOrgAgentConfig(ctx context.Context, arg GetOrgAgentConfigParams) (OrgAgentConfig, error) {
	row := q.db.QueryRow(ctx, GetOrgAgentConfig, arg.OrgID, arg.AgentID)
	var i OrgAgentConfig
	err := row.Scan(
		&i.ID,
		&i.OrgID,
		&i.AgentID,
		&i.Config,
		&i.IsEnabled,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}

const GetSystemPrompts = `-- name: GetSystemPrompts :many
SELECT
    id,
    scope_type,
    scope_id,
    agent_id,
    prompt,
    priority,
    created_at,
    updated_at
FROM system_prompts
WHERE (scope_type = 'org' AND scope_id = $1 AND (agent_id = $2 OR agent_id IS NULL))
   OR (scope_type = 'team' AND scope_id = $3 AND (agent_id = $2 OR agent_id IS NULL))
   OR (scope_type = 'employee' AND scope_id = $4 AND (agent_id = $2 OR agent_id IS NULL))
ORDER BY
    CASE scope_type
        WHEN 'org' THEN 1
        WHEN 'team' THEN 2
        WHEN 'employee' THEN 3
    END,
    priority ASC
`

type GetSystemPromptsParams struct {
	ScopeID   uuid.UUID   `json:"scope_id"`
	AgentID   pgtype.UUID `json:"agent_id"`
	ScopeID_2 uuid.UUID   `json:"scope_id_2"`
	ScopeID_3 uuid.UUID   `json:"scope_id_3"`
}

// Get all system prompts for org/team/employee + agent
// Returns prompts ordered by scope hierarchy (org -> team -> employee) then priority
func (q *Queries) GetSystemPrompts(ctx context.Context, arg GetSystemPromptsParams) ([]SystemPrompt, error) {
	rows, err := q.db.Query(ctx, GetSystemPrompts,
		arg.ScopeID,
		arg.AgentID,
		arg.ScopeID_2,
		arg.ScopeID_3,
	)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	items := []SystemPrompt{}
	for rows.Next() {
		var i SystemPrompt
		if err := rows.Scan(
			&i.ID,
			&i.ScopeType,
			&i.ScopeID,
			&i.AgentID,
			&i.Prompt,
			&i.Priority,
			&i.CreatedAt,
			&i.UpdatedAt,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const GetTeamAgentConfig = `-- name: GetTeamAgentConfig :one
SELECT
    id,
    team_id,
    agent_id,
    config_override,
    is_enabled,
    created_at,
    updated_at
FROM team_agent_configs
WHERE team_id = $1 AND agent_id = $2
`

type GetTeamAgentConfigParams struct {
	TeamID  uuid.UUID `json:"team_id"`
	AgentID uuid.UUID `json:"agent_id"`
}

// Get team-level config for an agent (requires team_id lookup)
func (q *Queries) GetTeamAgentConfig(ctx context.Context, arg GetTeamAgentConfigParams) (TeamAgentConfig, error) {
	row := q.db.QueryRow(ctx, GetTeamAgentConfig, arg.TeamID, arg.AgentID)
	var i TeamAgentConfig
	err := row.Scan(
		&i.ID,
		&i.TeamID,
		&i.AgentID,
		&i.ConfigOverride,
		&i.IsEnabled,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}

const GetTeamAgentConfigByID = `-- name: GetTeamAgentConfigByID :one
SELECT
    tac.id,
    tac.team_id,
    tac.agent_id,
    tac.config_override,
    tac.is_enabled,
    tac.created_at,
    tac.updated_at,
    a.name as agent_name,
    a.type as agent_type,
    a.provider as agent_provider
FROM team_agent_configs tac
JOIN agents a ON tac.agent_id = a.id
WHERE tac.id = $1
`

type GetTeamAgentConfigByIDRow struct {
	ID             uuid.UUID        `json:"id"`
	TeamID         uuid.UUID        `json:"team_id"`
	AgentID        uuid.UUID        `json:"agent_id"`
	ConfigOverride json.RawMessage  `json:"config_override"`
	IsEnabled      bool             `json:"is_enabled"`
	CreatedAt      pgtype.Timestamp `json:"created_at"`
	UpdatedAt      pgtype.Timestamp `json:"updated_at"`
	AgentName      string           `json:"agent_name"`
	AgentType      string           `json:"agent_type"`
	AgentProvider  string           `json:"agent_provider"`
}

// Get a specific team agent configuration by ID
func (q *Queries) GetTeamAgentConfigByID(ctx context.Context, id uuid.UUID) (GetTeamAgentConfigByIDRow, error) {
	row := q.db.QueryRow(ctx, GetTeamAgentConfigByID, id)
	var i GetTeamAgentConfigByIDRow
	err := row.Scan(
		&i.ID,
		&i.TeamID,
		&i.AgentID,
		&i.ConfigOverride,
		&i.IsEnabled,
		&i.CreatedAt,
		&i.UpdatedAt,
		&i.AgentName,
		&i.AgentType,
		&i.AgentProvider,
	)
	return i, err
}

const ListAgents = `-- name: ListAgents :many

SELECT
    id,
    name,
    type,
    description,
    provider,
    default_config,
    capabilities,
    llm_provider,
    llm_model,
    is_public,
    created_at,
    updated_at
FROM agents
WHERE is_public = true
ORDER BY name ASC
`

// Agent Queries
// These queries manage the available AI agents (Claude Code, Cursor, Windsurf, etc.)
// List all public/active agents
func (q *Queries) ListAgents(ctx context.Context) ([]Agent, error) {
	rows, err := q.db.Query(ctx, ListAgents)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	items := []Agent{}
	for rows.Next() {
		var i Agent
		if err := rows.Scan(
			&i.ID,
			&i.Name,
			&i.Type,
			&i.Description,
			&i.Provider,
			&i.DefaultConfig,
			&i.Capabilities,
			&i.LlmProvider,
			&i.LlmModel,
			&i.IsPublic,
			&i.CreatedAt,
			&i.UpdatedAt,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const ListEmployeeAgentConfigs = `-- name: ListEmployeeAgentConfigs :many

SELECT
    eac.id,
    eac.employee_id,
    eac.agent_id,
    eac.config_override,
    eac.is_enabled,
    eac.sync_token,
    eac.last_synced_at,
    eac.created_at,
    eac.updated_at,
    a.name as agent_name,
    a.type as agent_type,
    a.provider as agent_provider,
    a.default_config as agent_default_config
FROM employee_agent_configs eac
JOIN agents a ON eac.agent_id = a.id
WHERE eac.employee_id = $1
ORDER BY eac.created_at DESC
`

type ListEmployeeAgentConfigsRow struct {
	ID                 uuid.UUID        `json:"id"`
	EmployeeID         uuid.UUID        `json:"employee_id"`
	AgentID            uuid.UUID        `json:"agent_id"`
	ConfigOverride     json.RawMessage  `json:"config_override"`
	IsEnabled          bool             `json:"is_enabled"`
	SyncToken          *string          `json:"sync_token"`
	LastSyncedAt       pgtype.Timestamp `json:"last_synced_at"`
	CreatedAt          pgtype.Timestamp `json:"created_at"`
	UpdatedAt          pgtype.Timestamp `json:"updated_at"`
	AgentName          string           `json:"agent_name"`
	AgentType          string           `json:"agent_type"`
	AgentProvider      string           `json:"agent_provider"`
	AgentDefaultConfig json.RawMessage  `json:"agent_default_config"`
}

// Employee Agent Configuration Queries
// These queries manage agent assignments to employees
// List all agent configurations for a specific employee
func (q *Queries) ListEmployeeAgentConfigs(ctx context.Context, employeeID uuid.UUID) ([]ListEmployeeAgentConfigsRow, error) {
	rows, err := q.db.Query(ctx, ListEmployeeAgentConfigs, employeeID)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	items := []ListEmployeeAgentConfigsRow{}
	for rows.Next() {
		var i ListEmployeeAgentConfigsRow
		if err := rows.Scan(
			&i.ID,
			&i.EmployeeID,
			&i.AgentID,
			&i.ConfigOverride,
			&i.IsEnabled,
			&i.SyncToken,
			&i.LastSyncedAt,
			&i.CreatedAt,
			&i.UpdatedAt,
			&i.AgentName,
			&i.AgentType,
			&i.AgentProvider,
			&i.AgentDefaultConfig,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const ListOrgAgentConfigs = `-- name: ListOrgAgentConfigs :many
SELECT
    oac.id,
    oac.org_id,
    oac.agent_id,
    oac.config,
    oac.is_enabled,
    oac.created_at,
    oac.updated_at,
    a.name as agent_name,
    a.type as agent_type,
    a.provider as agent_provider,
    a.default_config as agent_default_config
FROM org_agent_configs oac
JOIN agents a ON oac.agent_id = a.id
WHERE oac.org_id = $1
ORDER BY a.name ASC
`

type ListOrgAgentConfigsRow struct {
	ID                 uuid.UUID        `json:"id"`
	OrgID              uuid.UUID        `json:"org_id"`
	AgentID            uuid.UUID        `json:"agent_id"`
	Config             json.RawMessage  `json:"config"`
	IsEnabled          bool             `json:"is_enabled"`
	CreatedAt          pgtype.Timestamp `json:"created_at"`
	UpdatedAt          pgtype.Timestamp `json:"updated_at"`
	AgentName          string           `json:"agent_name"`
	AgentType          string           `json:"agent_type"`
	AgentProvider      string           `json:"agent_provider"`
	AgentDefaultConfig json.RawMessage  `json:"agent_default_config"`
}

// List all org-level agent configs for an organization
func (q *Queries) ListOrgAgentConfigs(ctx context.Context, orgID uuid.UUID) ([]ListOrgAgentConfigsRow, error) {
	rows, err := q.db.Query(ctx, ListOrgAgentConfigs, orgID)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	items := []ListOrgAgentConfigsRow{}
	for rows.Next() {
		var i ListOrgAgentConfigsRow
		if err := rows.Scan(
			&i.ID,
			&i.OrgID,
			&i.AgentID,
			&i.Config,
			&i.IsEnabled,
			&i.CreatedAt,
			&i.UpdatedAt,
			&i.AgentName,
			&i.AgentType,
			&i.AgentProvider,
			&i.AgentDefaultConfig,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const ListTeamAgentConfigs = `-- name: ListTeamAgentConfigs :many

SELECT
    tac.id,
    tac.team_id,
    tac.agent_id,
    tac.config_override,
    tac.is_enabled,
    tac.created_at,
    tac.updated_at,
    a.name as agent_name,
    a.type as agent_type,
    a.provider as agent_provider
FROM team_agent_configs tac
JOIN agents a ON tac.agent_id = a.id
WHERE tac.team_id = $1
ORDER BY tac.created_at DESC
`

type ListTeamAgentConfigsRow struct {
	ID             uuid.UUID        `json:"id"`
	TeamID         uuid.UUID        `json:"team_id"`
	AgentID        uuid.UUID        `json:"agent_id"`
	ConfigOverride json.RawMessage  `json:"config_override"`
	IsEnabled      bool             `json:"is_enabled"`
	CreatedAt      pgtype.Timestamp `json:"created_at"`
	UpdatedAt      pgtype.Timestamp `json:"updated_at"`
	AgentName      string           `json:"agent_name"`
	AgentType      string           `json:"agent_type"`
	AgentProvider  string           `json:"agent_provider"`
}

// Team Agent Configuration CRUD Queries
// List all agent configurations for a specific team
func (q *Queries) ListTeamAgentConfigs(ctx context.Context, teamID uuid.UUID) ([]ListTeamAgentConfigsRow, error) {
	rows, err := q.db.Query(ctx, ListTeamAgentConfigs, teamID)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	items := []ListTeamAgentConfigsRow{}
	for rows.Next() {
		var i ListTeamAgentConfigsRow
		if err := rows.Scan(
			&i.ID,
			&i.TeamID,
			&i.AgentID,
			&i.ConfigOverride,
			&i.IsEnabled,
			&i.CreatedAt,
			&i.UpdatedAt,
			&i.AgentName,
			&i.AgentType,
			&i.AgentProvider,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const UpdateEmployeeAgentConfig = `-- name: UpdateEmployeeAgentConfig :one
UPDATE employee_agent_configs
SET
    config_override = COALESCE($2::jsonb, config_override),
    is_enabled = COALESCE($3::boolean, is_enabled),
    updated_at = NOW()
WHERE id = $1
RETURNING id, employee_id, agent_id, config_override, is_enabled, sync_token, last_synced_at, created_at, updated_at
`

type UpdateEmployeeAgentConfigParams struct {
	ID             uuid.UUID `json:"id"`
	ConfigOverride []byte    `json:"config_override"`
	IsEnabled      *bool     `json:"is_enabled"`
}

type UpdateEmployeeAgentConfigRow struct {
	ID             uuid.UUID        `json:"id"`
	EmployeeID     uuid.UUID        `json:"employee_id"`
	AgentID        uuid.UUID        `json:"agent_id"`
	ConfigOverride json.RawMessage  `json:"config_override"`
	IsEnabled      bool             `json:"is_enabled"`
	SyncToken      *string          `json:"sync_token"`
	LastSyncedAt   pgtype.Timestamp `json:"last_synced_at"`
	CreatedAt      pgtype.Timestamp `json:"created_at"`
	UpdatedAt      pgtype.Timestamp `json:"updated_at"`
}

// Update an existing agent configuration
func (q *Queries) UpdateEmployeeAgentConfig(ctx context.Context, arg UpdateEmployeeAgentConfigParams) (UpdateEmployeeAgentConfigRow, error) {
	row := q.db.QueryRow(ctx, UpdateEmployeeAgentConfig, arg.ID, arg.ConfigOverride, arg.IsEnabled)
	var i UpdateEmployeeAgentConfigRow
	err := row.Scan(
		&i.ID,
		&i.EmployeeID,
		&i.AgentID,
		&i.ConfigOverride,
		&i.IsEnabled,
		&i.SyncToken,
		&i.LastSyncedAt,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}

const UpdateOrgAgentConfig = `-- name: UpdateOrgAgentConfig :one
UPDATE org_agent_configs
SET
    config = COALESCE($2::jsonb, config),
    is_enabled = COALESCE($3::boolean, is_enabled),
    updated_at = NOW()
WHERE id = $1
RETURNING id, org_id, agent_id, config, is_enabled, created_at, updated_at
`

type UpdateOrgAgentConfigParams struct {
	ID        uuid.UUID `json:"id"`
	Config    []byte    `json:"config"`
	IsEnabled *bool     `json:"is_enabled"`
}

// Update org-level agent config
func (q *Queries) UpdateOrgAgentConfig(ctx context.Context, arg UpdateOrgAgentConfigParams) (OrgAgentConfig, error) {
	row := q.db.QueryRow(ctx, UpdateOrgAgentConfig, arg.ID, arg.Config, arg.IsEnabled)
	var i OrgAgentConfig
	err := row.Scan(
		&i.ID,
		&i.OrgID,
		&i.AgentID,
		&i.Config,
		&i.IsEnabled,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}

const UpdateTeamAgentConfig = `-- name: UpdateTeamAgentConfig :one
UPDATE team_agent_configs
SET
    config_override = COALESCE($2::jsonb, config_override),
    is_enabled = COALESCE($3::boolean, is_enabled),
    updated_at = NOW()
WHERE id = $1
RETURNING id, team_id, agent_id, config_override, is_enabled, created_at, updated_at
`

type UpdateTeamAgentConfigParams struct {
	ID             uuid.UUID `json:"id"`
	ConfigOverride []byte    `json:"config_override"`
	IsEnabled      *bool     `json:"is_enabled"`
}

// Update an existing team agent configuration
func (q *Queries) UpdateTeamAgentConfig(ctx context.Context, arg UpdateTeamAgentConfigParams) (TeamAgentConfig, error) {
	row := q.db.QueryRow(ctx, UpdateTeamAgentConfig, arg.ID, arg.ConfigOverride, arg.IsEnabled)
	var i TeamAgentConfig
	err := row.Scan(
		&i.ID,
		&i.TeamID,
		&i.AgentID,
		&i.ConfigOverride,
		&i.IsEnabled,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}
