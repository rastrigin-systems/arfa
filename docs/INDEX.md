# Documentation Index

## ğŸ“Š Entity Relationship Diagrams

### Primary ERD
- **[ERD.md](ERD.md)** - Complete Mermaid ERD with all 20 tables and relationships
  - Visual representation of the entire database schema
  - Includes table definitions, relationships, and constraints
  - Interactive and easy to read

### Generated Diagrams (by tbls)
- **[schema.svg](schema.svg)** - Full database schema diagram
- **[schema.json](schema.json)** - Machine-readable schema
- **Individual table SVGs** - 24 separate diagrams (one per table/view)

## ğŸ“š Table Documentation

### Core Organization (5 tables)
- [organizations](public.organizations.md) - Top-level tenant
- [subscriptions](public.subscriptions.md) - Billing and budgets
- [teams](public.teams.md) - Group employees
- [roles](public.roles.md) - Permission definitions
- [employees](public.employees.md) - User accounts

### Agent Management (7 tables)
- [agent_catalog](public.agent_catalog.md) - Available AI agents
- [tools](public.tools.md) - Tool registry (fs, git, http, etc.)
- [policies](public.policies.md) - Usage policies
- [agent_tools](public.agent_tools.md) - Agent â†” Tool mapping
- [agent_policies](public.agent_policies.md) - Agent â†” Policy mapping
- [team_policies](public.team_policies.md) - Team-specific policies
- [employee_agent_configs](public.employee_agent_configs.md) - Per-employee agent instances

### MCP Configuration (3 tables)
- [mcp_categories](public.mcp_categories.md) - MCP server categories
- [mcp_catalog](public.mcp_catalog.md) - Available MCP servers
- [employee_mcp_configs](public.employee_mcp_configs.md) - Per-employee MCP instances

### Authentication (1 table)
- [sessions](public.sessions.md) - JWT session tracking

### Approvals (2 tables)
- [agent_requests](public.agent_requests.md) - Employee requests
- [approvals](public.approvals.md) - Approval workflow

### Analytics (2 tables)
- [activity_logs](public.activity_logs.md) - Audit trail
- [usage_records](public.usage_records.md) - Cost and resource tracking

### Views (3)
- [v_employee_agents](public.v_employee_agents.md) - Employee agents with details
- [v_employee_mcps](public.v_employee_mcps.md) - Employee MCPs with details
- [v_pending_approvals](public.v_pending_approvals.md) - Approval queue

## ğŸ“ˆ Statistics

- **Total Tables**: 20 base tables
- **Views**: 3 materialized views
- **Total Columns**: ~150
- **Foreign Keys**: 25+
- **Indexes**: 50+
- **Junction Tables**: 3 (many-to-many relationships)
- **Documentation Files**: 50 (25 markdown + 24 SVG + 1 JSON)

## ğŸ—‚ï¸ File Organization

```
docs/
â”œâ”€â”€ INDEX.md                          # This file
â”œâ”€â”€ README.md                         # Main documentation index (generated by tbls)
â”œâ”€â”€ ERD.md                            # Mermaid ERD diagram
â”œâ”€â”€ schema.svg                        # Full schema diagram
â”œâ”€â”€ schema.json                       # Machine-readable schema
â”‚
â”œâ”€â”€ public.organizations.md           # Organization table docs
â”œâ”€â”€ public.organizations.svg          # Organization table diagram
â”œâ”€â”€ public.subscriptions.md
â”œâ”€â”€ public.subscriptions.svg
â”œâ”€â”€ ... (20 tables Ã— 2 files each)
â”‚
â””â”€â”€ public.v_*.md                     # View documentation
```

## ğŸ”— Quick Links

### For Developers
- [ERD.md](ERD.md) - Start here for understanding the schema
- [README.md](README.md) - Complete table index
- [schema.json](schema.json) - For tooling/automation

### For Specific Features
- **Employee Management**: [employees](public.employees.md), [teams](public.teams.md), [roles](public.roles.md)
- **Agent Configuration**: [agent_catalog](public.agent_catalog.md), [employee_agent_configs](public.employee_agent_configs.md)
- **MCP Setup**: [mcp_catalog](public.mcp_catalog.md), [employee_mcp_configs](public.employee_mcp_configs.md)
- **Approvals**: [agent_requests](public.agent_requests.md), [approvals](public.approvals.md)
- **Analytics**: [activity_logs](public.activity_logs.md), [usage_records](public.usage_records.md)

## ğŸ”„ Regenerating Documentation

All documentation (except ERD.md which is manually curated) is auto-generated from the database:

```bash
# Regenerate all docs
make generate-erd

# This runs:
# tbls doc postgres://... docs/ --force
```

The generator creates:
- README.md (index)
- schema.svg (full diagram)
- schema.json (machine-readable)
- public.*.md (one per table/view)
- public.*.svg (one per table/view)

**Note**: ERD.md is manually maintained and provides a more readable Mermaid diagram.

## ğŸ“ Documentation Standards

Each table documentation includes:
- **Columns**: Name, type, nullable, default
- **Constraints**: Primary keys, unique constraints
- **Indexes**: All indexes on the table
- **Foreign Keys**: Relationships to other tables
- **Referenced By**: Tables that reference this table
- **Diagram**: Visual representation (SVG)

## ğŸ¯ Use Cases

### 1. Understanding Relationships
â†’ See [ERD.md](ERD.md) for the complete visual map

### 2. Finding a Specific Table
â†’ Use [README.md](README.md) table index

### 3. Exploring Foreign Keys
â†’ Each table doc shows "Foreign-key constraints" and "Referenced by" sections

### 4. Generating Client Code
â†’ Use [schema.json](schema.json) for automated code generation

### 5. Database Migrations
â†’ Compare [schema.json](schema.json) between versions to detect changes

---

**Last Updated**: 2025-10-28  
**Schema Version**: 1.0.0  
**Generated by**: tbls + manual curation  
**Database**: PostgreSQL 15+
