# Wireframe: Reset Password (Story 1.4 - Part 2)

**Page:** `/reset-password/[token]`
**Status:** ðŸ“‹ Planned
**Story:** [docs/user-stories/epic-1-authentication/1.4-password-reset.md](../../user-stories/epic-1-authentication/1.4-password-reset.md)

---

## Layout Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                â”‚
â”‚                         [Background]                           â”‚
â”‚                                                                â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚         â”‚                                      â”‚              â”‚
â”‚         â”‚       Ubik Enterprise                â”‚              â”‚
â”‚         â”‚       Reset Password                 â”‚              â”‚
â”‚         â”‚                                      â”‚              â”‚
â”‚         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚              â”‚
â”‚         â”‚  â”‚ New Password                 â”‚   â”‚              â”‚
â”‚         â”‚  â”‚ [â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢____________]       â”‚   â”‚              â”‚
â”‚         â”‚  â”‚ Password strength: Strong    â”‚   â”‚              â”‚
â”‚         â”‚  â”‚ âœ“ 8+ characters              â”‚   â”‚              â”‚
â”‚         â”‚  â”‚ âœ“ Uppercase letter           â”‚   â”‚              â”‚
â”‚         â”‚  â”‚ âœ“ Number                     â”‚   â”‚              â”‚
â”‚         â”‚  â”‚ âœ“ Special character          â”‚   â”‚              â”‚
â”‚         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚              â”‚
â”‚         â”‚                                      â”‚              â”‚
â”‚         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚              â”‚
â”‚         â”‚  â”‚ Confirm Password             â”‚   â”‚              â”‚
â”‚         â”‚  â”‚ [â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢____________]       â”‚   â”‚              â”‚
â”‚         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚              â”‚
â”‚         â”‚                                      â”‚              â”‚
â”‚         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚              â”‚
â”‚         â”‚  â”‚    Reset Password            â”‚   â”‚              â”‚
â”‚         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚              â”‚
â”‚         â”‚                                      â”‚              â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Component Specifications

### 1. Page Container
- **Layout:** Centered card on light background
- **Card:** White background, rounded corners, shadow
- **Max Width:** 512px (lg breakpoint)
- **Padding:** 16px on mobile, 24px on desktop

### 2. Header Section
- **Title:** "Ubik Enterprise" - 30px, bold, center-aligned
- **Subtitle:** "Reset Password" - 24px, semi-bold, center-aligned
- **Spacing:** 8px between title and subtitle

### 3. Form Fields

**Field Order:**
1. New Password (with strength indicator)
2. Confirm Password

**Each Field Contains:**
- Label (14px, medium weight)
- Input box (full width, 40px height)
- Validation message area (below input)

### 4. Password Field (with Strength Indicator)

**Same as registration - see 1.1 wireframe for details:**
- Real-time strength calculation
- Inline requirement checklist
- Color-coded strength indicator
- Requirements: 8+ chars, uppercase, number, special character

### 5. Submit Button

**Default State:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Reset Password            â”‚  â† Blue background, white text
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Loading State:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â³ Resetting...             â”‚  â† Blue background, spinner
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Disabled State:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Reset Password            â”‚  â† Gray background, disabled
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## States & Interactions

### State 1: Valid Token - Empty Form
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                      â”‚
â”‚       Ubik Enterprise                â”‚
â”‚       Reset Password                 â”‚
â”‚                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ New Password                 â”‚   â”‚
â”‚  â”‚ [________________]           â”‚   â”‚
â”‚  â”‚ Password strength: Weak      â”‚   â”‚
â”‚  â”‚ â—‹ 8+ characters              â”‚   â”‚
â”‚  â”‚ â—‹ Uppercase letter           â”‚   â”‚
â”‚  â”‚ â—‹ Number                     â”‚   â”‚
â”‚  â”‚ â—‹ Special character          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Confirm Password             â”‚   â”‚
â”‚  â”‚ [________________]           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚    Reset Password            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### State 2: Password Mismatch Error
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                      â”‚
â”‚       Ubik Enterprise                â”‚
â”‚       Reset Password                 â”‚
â”‚                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ New Password                 â”‚   â”‚
â”‚  â”‚ [Password123!____]           â”‚   â”‚
â”‚  â”‚ Password strength: Strong    â”‚   â”‚
â”‚  â”‚ âœ“ 8+ characters              â”‚   â”‚
â”‚  â”‚ âœ“ Uppercase letter           â”‚   â”‚
â”‚  â”‚ âœ“ Number                     â”‚   â”‚
â”‚  â”‚ âœ“ Special character          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Confirm Password             â”‚   â”‚
â”‚  â”‚ [Password123______]          â”‚   â”‚ â† Red border
â”‚  â”‚ âœ— Passwords do not match    â”‚   â”‚ â† Red error
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚    Reset Password            â”‚   â”‚ â† Disabled
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Mismatch Behavior:**
- Real-time validation as user types in confirm field
- Red border on confirm password field
- Red error text: "âœ— Passwords do not match"
- Submit button disabled until passwords match

### State 3: Loading (Form Submission)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                      â”‚
â”‚       Ubik Enterprise                â”‚
â”‚       Reset Password                 â”‚
â”‚                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ New Password                 â”‚   â”‚
â”‚  â”‚ [Password123!____]           â”‚   â”‚ â† Disabled
â”‚  â”‚ Password strength: Strong    â”‚   â”‚
â”‚  â”‚ âœ“ 8+ characters              â”‚   â”‚
â”‚  â”‚ âœ“ Uppercase letter           â”‚   â”‚
â”‚  â”‚ âœ“ Number                     â”‚   â”‚
â”‚  â”‚ âœ“ Special character          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Confirm Password             â”‚   â”‚
â”‚  â”‚ [Password123!____]           â”‚   â”‚ â† Disabled
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚   â³ Resetting...            â”‚   â”‚ â† Loading
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### State 4: Success (Redirect to Login)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                      â”‚
â”‚       Ubik Enterprise                â”‚
â”‚       Reset Password                 â”‚
â”‚                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ âœ… Password reset successful!   â”‚â”‚  â† Green banner
â”‚  â”‚                                 â”‚â”‚
â”‚  â”‚ Redirecting to login...         â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Success Flow:**
1. Success banner appears: "âœ… Password reset successful!"
2. Subtext: "Redirecting to login..."
3. 2-second delay
4. Automatic redirect to /login
5. User can now login with new password

### State 5: Expired Token Error
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                      â”‚
â”‚       Ubik Enterprise                â”‚
â”‚       Reset Password                 â”‚
â”‚                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ âš ï¸ This reset link has expired  â”‚â”‚  â† Red banner
â”‚  â”‚                                 â”‚â”‚
â”‚  â”‚ Password reset links are valid  â”‚â”‚
â”‚  â”‚ for 1 hour.                     â”‚â”‚
â”‚  â”‚                                 â”‚â”‚
â”‚  â”‚ [Request new reset link]        â”‚â”‚  â† Link to /forgot-password
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Expired Token Details:**
- Red error banner
- Icon: âš ï¸ (warning)
- Main message: "This reset link has expired"
- Explanation: "Password reset links are valid for 1 hour."
- Action button: "Request new reset link" â†’ links to /forgot-password
- No form shown (token invalid)

### State 6: Already-Used Token Error
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                      â”‚
â”‚       Ubik Enterprise                â”‚
â”‚       Reset Password                 â”‚
â”‚                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ âš ï¸ This reset link has already  â”‚â”‚  â† Red banner
â”‚  â”‚    been used                    â”‚â”‚
â”‚  â”‚                                 â”‚â”‚
â”‚  â”‚ Password reset links can only   â”‚â”‚
â”‚  â”‚ be used once.                   â”‚â”‚
â”‚  â”‚                                 â”‚â”‚
â”‚  â”‚ [Request new reset link]        â”‚â”‚  â† Link to /forgot-password
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Already-Used Token Details:**
- Red error banner
- Icon: âš ï¸ (warning)
- Main message: "This reset link has already been used"
- Explanation: "Password reset links can only be used once."
- Action button: "Request new reset link" â†’ links to /forgot-password
- No form shown (token invalid)

---

## User Flows

### Flow 1: Successful Password Reset
```
1. User clicks reset link from email
2. Page loads with token in URL: /reset-password/abc123...
3. API verifies token is valid (not expired, not used)
4. Form loads
5. User enters new password: "NewPass123!"
6. Password strength shows "Strong" (all requirements met)
7. User enters confirm password: "NewPass123!"
8. Passwords match (no error)
9. User clicks "Reset Password"
10. Button changes to "Resetting..." (disabled)
11. API request to POST /api/v1/auth/reset-password
12. Success: Password updated in database
13. Token marked as used (used_at = now)
14. Success banner appears
15. 2-second delay
16. Redirect to /login
17. User can now login with new password
```

### Flow 2: Expired Token
```
1. User clicks reset link from email (sent >1 hour ago)
2. Page loads with token in URL
3. API verifies token
4. Token expired (expires_at < now)
5. Error page shown: "This reset link has expired"
6. User clicks "Request new reset link"
7. Navigate to /forgot-password
8. User can request a new reset email
```

### Flow 3: Already-Used Token
```
1. User clicks reset link from email (already used once)
2. Page loads with token in URL
3. API verifies token
4. Token already used (used_at is not null)
5. Error page shown: "This reset link has already been used"
6. User clicks "Request new reset link"
7. Navigate to /forgot-password
8. User can request a new reset email
```

### Flow 4: Passwords Don't Match
```
1. User on reset password page with valid token
2. User enters new password: "NewPass123!"
3. User enters confirm password: "NewPass123" (typo - missing !)
4. Real-time validation detects mismatch
5. Red border on confirm password field
6. Error message: "Passwords do not match"
7. Submit button disabled
8. User corrects confirm password
9. Validation passes
10. Submit button enabled
11. User can now submit
```

---

## Token Verification Flow

**On page load, verify token validity:**

```javascript
// Pseudocode
async function verifyToken(token) {
  const response = await fetch(`/api/v1/auth/verify-reset-token/${token}`);

  if (response.ok) {
    // Token valid - show form
    return { valid: true };
  } else {
    const error = await response.json();

    if (error.code === 'TOKEN_EXPIRED') {
      // Show expired error state
      return { valid: false, reason: 'expired' };
    }

    if (error.code === 'TOKEN_USED') {
      // Show already-used error state
      return { valid: false, reason: 'used' };
    }

    if (error.code === 'TOKEN_INVALID') {
      // Show generic invalid error
      return { valid: false, reason: 'invalid' };
    }
  }
}
```

---

## Validation Rules

### Client-Side Validation
1. **New Password:** Required, 8+ chars, uppercase, number, special character
2. **Confirm Password:** Required, must match new password

### Server-Side Validation
1. **Token validity:** Not expired, not used, exists in database
2. **Password requirements:** Same as client-side
3. **Password update:** Hash password, update employee record
4. **Token marking:** Set used_at timestamp

---

## Accessibility

### Keyboard Navigation
- Tab order: New Password â†’ Confirm Password â†’ Reset Password button
- Enter key: Submit form (when focused on any input)

### Screen Reader Annotations
- Error banners: `role="alert"`
- Password requirements: `aria-describedby="password-requirements"`
- Mismatch error: `aria-live="polite"`
- Success message: `role="alert"`

### ARIA Labels
- New Password: `aria-label="New password"`
- Confirm Password: `aria-label="Confirm new password"`
- Submit button: `aria-label="Reset your password"`
- Error messages: `aria-describedby` linking to error text

### Focus Management
- Valid token: Focus on new password field
- Invalid token: Focus on error message
- Mismatch: Focus on confirm password field
- Success: Focus on success message

---

## Technical Implementation Notes

**API Endpoints:**

1. **Verify Token (GET):**
   - `GET /api/v1/auth/verify-reset-token/:token`
   - Response: 200 OK (valid) or 400/404 (invalid/expired/used)
   - Called on page load

2. **Reset Password (POST):**
   - `POST /api/v1/auth/reset-password`
   - Request body: `{ token, password, confirm_password }`
   - Response: 200 OK (success) or 400 (validation error)

**Token Validation Logic:**
```sql
SELECT * FROM password_reset_tokens
WHERE token = $1
  AND expires_at > NOW()
  AND used_at IS NULL;
```

**Password Update Logic:**
1. Verify token is valid (not expired, not used)
2. Hash new password (bcrypt, cost factor 12)
3. Update employee's password
4. Mark token as used: `UPDATE password_reset_tokens SET used_at = NOW() WHERE token = $1`
5. Return success

**Security Measures:**
1. **Single-use tokens:** Mark as used after successful reset
2. **Expiration:** 1 hour from creation
3. **Strong validation:** Enforce password requirements server-side
4. **Token verification first:** Check token before showing form
5. **HTTPS only:** Reset links must use HTTPS in production

---

## Design Decisions

1. **Verify token on page load** - Show error immediately if token invalid
2. **Same password requirements as registration** - Consistency
3. **Real-time password match validation** - Immediate feedback
4. **Clear error states for token issues** - User knows exactly what's wrong
5. **Helpful error messages** - Link back to forgot-password for new token
6. **Auto-redirect after success** - Smooth UX, user can login immediately
7. **2-second success delay** - User sees confirmation before redirect

---

## Responsive Behavior

**Mobile (320px - 767px):**
- Card full width with 16px padding
- Font sizes slightly smaller
- Touch-friendly 44px minimum touch targets

**Desktop (1024px+):**
- Centered card, max-width 512px
- Larger padding (24px)
- Hover states on inputs and buttons

---

## Related Pages

- **Forgot password:** `/forgot-password` - Request new reset link
- **Login:** `/login` - Destination after successful reset

---

**Last Updated:** 2025-11-09
**Status:** Planned ðŸ“‹
**Priority:** P2 (Medium)
**Issue:** #155
