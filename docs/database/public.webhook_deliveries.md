# public.webhook_deliveries

## Description

## Columns

| Name | Type | Default | Nullable | Children | Parents | Comment |
| ---- | ---- | ------- | -------- | -------- | ------- | ------- |
| id | uuid | gen_random_uuid() | false |  |  |  |
| destination_id | uuid |  | false |  | [public.webhook_destinations](public.webhook_destinations.md) |  |
| log_id | uuid |  | false |  | [public.activity_logs](public.activity_logs.md) |  |
| status | varchar(50) | 'pending'::character varying | false |  |  |  |
| attempts | integer | 0 | false |  |  |  |
| last_attempt_at | timestamp without time zone |  | true |  |  |  |
| next_retry_at | timestamp without time zone |  | true |  |  |  |
| response_status | integer |  | true |  |  |  |
| response_body | text |  | true |  |  |  |
| error_message | text |  | true |  |  |  |
| created_at | timestamp without time zone | now() | false |  |  |  |
| delivered_at | timestamp without time zone |  | true |  |  |  |

## Constraints

| Name | Type | Definition |
| ---- | ---- | ---------- |
| webhook_deliveries_status_check | CHECK | CHECK (((status)::text = ANY ((ARRAY['pending'::character varying, 'delivered'::character varying, 'failed'::character varying, 'dead'::character varying])::text[]))) |
| webhook_deliveries_log_id_fkey | FOREIGN KEY | FOREIGN KEY (log_id) REFERENCES activity_logs(id) ON DELETE CASCADE |
| webhook_deliveries_destination_id_fkey | FOREIGN KEY | FOREIGN KEY (destination_id) REFERENCES webhook_destinations(id) ON DELETE CASCADE |
| webhook_deliveries_pkey | PRIMARY KEY | PRIMARY KEY (id) |
| webhook_deliveries_destination_id_log_id_key | UNIQUE | UNIQUE (destination_id, log_id) |

## Indexes

| Name | Definition |
| ---- | ---------- |
| webhook_deliveries_pkey | CREATE UNIQUE INDEX webhook_deliveries_pkey ON public.webhook_deliveries USING btree (id) |
| webhook_deliveries_destination_id_log_id_key | CREATE UNIQUE INDEX webhook_deliveries_destination_id_log_id_key ON public.webhook_deliveries USING btree (destination_id, log_id) |
| idx_webhook_deliveries_pending | CREATE INDEX idx_webhook_deliveries_pending ON public.webhook_deliveries USING btree (status, next_retry_at) WHERE ((status)::text = ANY ((ARRAY['pending'::character varying, 'failed'::character varying])::text[])) |
| idx_webhook_deliveries_destination | CREATE INDEX idx_webhook_deliveries_destination ON public.webhook_deliveries USING btree (destination_id) |
| idx_webhook_deliveries_log | CREATE INDEX idx_webhook_deliveries_log ON public.webhook_deliveries USING btree (log_id) |

## Relations

```mermaid
erDiagram

"public.webhook_deliveries" }o--|| "public.webhook_destinations" : "FOREIGN KEY (destination_id) REFERENCES webhook_destinations(id) ON DELETE CASCADE"
"public.webhook_deliveries" }o--|| "public.activity_logs" : "FOREIGN KEY (log_id) REFERENCES activity_logs(id) ON DELETE CASCADE"

"public.webhook_deliveries" {
  uuid id
  uuid destination_id FK
  uuid log_id FK
  varchar_50_ status
  integer attempts
  timestamp_without_time_zone last_attempt_at
  timestamp_without_time_zone next_retry_at
  integer response_status
  text response_body
  text error_message
  timestamp_without_time_zone created_at
  timestamp_without_time_zone delivered_at
}
"public.webhook_destinations" {
  uuid id
  uuid org_id FK
  varchar_100_ name
  text url
  varchar_50_ auth_type
  jsonb auth_config
  text__ event_types
  jsonb event_filter
  boolean enabled
  integer batch_size
  integer timeout_ms
  integer retry_max
  integer retry_backoff_ms
  varchar_255_ signing_secret
  uuid created_by FK
  timestamp_without_time_zone created_at
  timestamp_without_time_zone updated_at
}
"public.activity_logs" {
  uuid id
  uuid org_id FK
  uuid employee_id FK
  uuid session_id
  varchar_100_ client_name
  varchar_50_ client_version
  varchar_100_ event_type
  varchar_50_ event_category
  text content
  jsonb payload
  timestamp_without_time_zone created_at
}
```

---

> Generated by [tbls](https://github.com/k1LoW/tbls)
