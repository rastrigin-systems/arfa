<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ubik Enterprise - AI Agent Management</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- htmx for AJAX -->
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>

    <!-- Alpine.js for interactivity -->
    <script src="https://unpkg.com/alpinejs@3.13.0/dist/cdn.min.js" defer></script>

    <!-- Custom Tailwind Config -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3b82f6',
                        secondary: '#6b7280'
                    }
                }
            }
        }
    </script>

    <style>
        [x-cloak] { display: none !important; }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Header -->
    <nav class="bg-white shadow-sm border-b border-gray-200">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16 items-center">
                <div class="flex items-center space-x-8">
                    <span class="text-xl font-bold text-blue-600">Ubik Enterprise</span>
                    <span id="org-name" class="text-gray-600">[Loading...]</span>
                </div>
                <div class="flex items-center space-x-4" x-data="{ open: false }">
                    <span id="user-email" class="text-gray-700">Loading...</span>
                    <button @click="open = !open" class="text-gray-600 hover:text-gray-900">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                        </svg>
                    </button>
                    <div x-show="open" @click.away="open = false" x-cloak
                         class="absolute right-4 top-14 mt-2 w-48 bg-white rounded-md shadow-lg py-1 z-50">
                        <a href="/profile.html" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">My Profile</a>
                        <a href="#" onclick="logout()" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Logout</a>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Navigation Tabs -->
    <div class="bg-white border-b border-gray-200">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <nav class="flex space-x-8 h-12" aria-label="Tabs">
                <a href="/dashboard.html" class="nav-link border-b-2 border-blue-500 text-blue-600 px-1 py-3 text-sm font-medium">
                    Dashboard
                </a>
                <a href="/employees.html" class="nav-link border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 px-1 py-3 text-sm font-medium">
                    Employees
                </a>
                <a href="/teams.html" class="nav-link border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 px-1 py-3 text-sm font-medium">
                    Teams
                </a>
                <a href="/agents.html" class="nav-link border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 px-1 py-3 text-sm font-medium">
                    Agents
                </a>
                <a href="/settings.html" class="nav-link border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 px-1 py-3 text-sm font-medium">
                    Settings
                </a>
            </nav>
        </div>
    </div>

    <!-- Main Content (to be replaced by specific pages) -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <div id="content">
            <!-- Page content goes here -->
        </div>
    </main>

    <!-- JavaScript -->
    <script>
        // API Configuration
        const API_BASE = '/api/v1';

        // Get auth token from localStorage
        function getToken() {
            return localStorage.getItem('auth_token');
        }

        // Set auth token
        function setToken(token) {
            localStorage.setItem('auth_token', token);
        }

        // Logout
        function logout() {
            fetch(`${API_BASE}/auth/logout`, {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${getToken()}`
                }
            }).finally(() => {
                localStorage.removeItem('auth_token');
                window.location.href = '/login.html';
            });
        }

        // Load current user
        async function loadCurrentUser() {
            const token = getToken();
            if (!token) {
                window.location.href = '/login.html';
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/auth/me`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (!response.ok) {
                    throw new Error('Unauthorized');
                }

                const employee = await response.json();
                document.getElementById('user-email').textContent = employee.email;

                // Load organization
                const orgResponse = await fetch(`${API_BASE}/organizations/current`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (orgResponse.ok) {
                    const org = await orgResponse.json();
                    document.getElementById('org-name').textContent = `[${org.name}]`;
                }
            } catch (error) {
                console.error('Failed to load user:', error);
                window.location.href = '/login.html';
            }
        }

        // Configure htmx to include auth token
        document.body.addEventListener('htmx:configRequest', (event) => {
            event.detail.headers['Authorization'] = `Bearer ${getToken()}`;
        });

        // Load user on page load
        if (!window.location.pathname.endsWith('login.html')) {
            loadCurrentUser();
        }

        // Highlight active nav link
        document.addEventListener('DOMContentLoaded', () => {
            const currentPage = window.location.pathname.split('/').pop() || 'dashboard.html';
            document.querySelectorAll('.nav-link').forEach(link => {
                const linkPage = link.getAttribute('href').split('/').pop();
                if (linkPage === currentPage) {
                    link.classList.remove('border-transparent', 'text-gray-500');
                    link.classList.add('border-blue-500', 'text-blue-600');
                } else {
                    link.classList.remove('border-blue-500', 'text-blue-600');
                    link.classList.add('border-transparent', 'text-gray-500');
                }
            });
        });
    </script>
</body>
</html>
